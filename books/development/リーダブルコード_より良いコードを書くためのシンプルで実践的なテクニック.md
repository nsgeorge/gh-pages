---
layout: default
description: リーダブルコード ―より良いコードを書くためのシンプルで実践的なテクニック (Theory in practice), Dustin Boswell, Trevor Foucher, 須藤 功平, 角 征典
---

# [リーダブルコード](https://www.oreilly.co.jp/books/9784873115658/)

---

# 表面上の改善

---

## 名前に情報を詰め込む

 - 明確な単語を選ぶ
   - 取得する先に応じた名前をつける
     - getPage: どこから持ってくるのかわからない
     - downloadPage: HTTP通信してそうな意味が付加される
     - selectPage: DBからデータを取得してそうな意味が付加される
   - なんの値か明確にする
     - size(): なんのサイズかわからない
     - height(): 高さであることがわかる
     - MemoryBytes(): 単位もついててよりGood
 - 一時的な変数でもちゃんと名前をつける
   - tmp, retval, i, j等は避ける
     - 状況に応じた適切な変数名を使う
     - 例えば2乗値の計算なら、`tmp`よりも`sum_squares`を使う
     - 生存期間が数行の本当に一時的な値なら許容される
     - i, jなどのイテレータ用の変数も`user_i`や`shcool_j`などとしたほうがバグを見つけやすくなる
 - 名前に情報を付加する
   - 変数名に単位をつけることで思わぬバグを防げる
     - xx_sec, xx_msec, xx_mb, xx_kb, xx_utf8, xx_sjis ...等
   - セキュアな情報にも活用できる
     - password -> plaintext_password(暗号化しなきゃ！)
     - comment -> unescaped_comment(エスケープしなきゃ！)
 - 独自の省略形や頭文字表記は避ける
   - プロジェクト固有の省略表記は避ける
   - 一般的な省略表記は許容される
     - eval, doc, str ...等
 - 不要な単語は削除する
   - convertToString()はtoString()にしても情報が失われない

## 誤解されない名前

 - `filter("year <= 2011")`は選択する機能か除外する機能か？
   - filterは曖昧な言葉なので使わない方が良い
   - 選択するのなら`select`とすべきだし
   - 除外するなら`exclude`とすべき
 - 限界値を決めるときは`min`と`max`を使う
   - `XX_LIMIT`という定数は曖昧で、off-by-oneエラーを引き起こす
   - 限界値をmin, maxで表現することで限界値が明確になる
   - `count == max`か許容されるが`count > max`は許容されないことは明確
 - 範囲を指定するときは`first`と`last`を使う
   - これも「未満」と「以下」の問題の一例
   - start, stopだとstopが包含なのかどうかがわからない
   - first, lastを使うことで包含していることが明確になる
   - 一方、包含／排他的範囲の場合は`begin`と`end`が分かりやすい
 - ブール値の名前
   - is, has, can, shouldなどをつけてわかりやすくする
   - 否定形ではなく肯定形の形で表現する
     - `disable_ssl = false`より`use_ssl = true`を使う
 - メソッドを呼び出す側の期待に合わせる
   - `getSummary()`は軽量アクセサという印象を与える
   - `calculateSummary()`は何かしらの計算処理があるという印象を与える
     - メソッドのコストの高さがある程度表現できたほうが良い
 
> Off-by-one エラー - Murga  
> http://neos21.hatenablog.jp/entry/2017/02/04/003512

## 美しさ

 - 読み手のことを考えたレイアウトを意識する
   - 読み手がなれているパターンと一貫性のあるレイアウトを使う
   - 似ているコードは似ているように見せる
   - 関連するコードをまとめてブロックにする
 - 縦の線をまっすぐにする
   - 複数行に渡る連続する`=`の位置や変数の位置など
   - 見た目だけの問題ではなくて、タイプミスや引数の間違いなどに気づきやすくなる
 - 一貫性と意味のある並びにする
   - コードの並びがロジックに関係ない場合、意味のある順番に並べると良い
   - タイプごと、重要な変数順、アルファベット順 ...など

## コメントすべき事を知る

 - コードから「すぐに」分かることはコメントに書かない
   - XXを定義する、XXを設定する、XXを画面に表示する ...等
   - ただし、この「すぐに」の部分が重要
   - コードを読むよりもコメントの方が早く理解できる場合は価値がある
 - 変数名、メソッド名の埋め合わせとしてコメントを使わない
   - こういう場合は変数名やメソッド名の方を変えてコメントがなくても意味が通じるようにする
 - 自分の考えやその実装の背景をコメントとして残す
   - コメントを読んだ人が無駄なテストや試行、リファクタリングをしないような情報が望ましい
   - 以下のような感じ
     - // XXの実装よりこちらの実装のほうが高速なので採用した
     - // 本来XXすべきだが、YYの理由によりこちらの方式を採用せざるを得ない
 - 定数にコメントをつける
   - その定数の意味や根拠があればそれを書いておくことで後のチューニングや設定変更に役立つ
     - // 2 * サーバー数以上の値にすること
     - // YYという理由からXX以上にはならないのでざっくりこの値にした
 - ハマりそうな罠を告知する
   - 以下のような忠告があれば内部の実装を知らなくても罠を回避できる
     - // メソッド内で外部サービスと通信している（1分でタイムアウトする）
     - // 大きいファイルファイルを解析するので大量のメモリを使う可能性がある

## コメントは正確で簡潔に

 - 曖昧な代名詞を避ける
   - それ、これ、あの ...等のコメントは誤解や誤った解釈に繋がるのでできるだけ避ける
 - 入出力のコーナーケースに実例を使う
   - 関数の動作を説明する例としてその動作例を実際のin, outを使ってコメントする
   - // "image.jpeg"から".jpeg"を除外して"image"を返す
 - コードの意図を書く
   - プログラムの動作を高レベルで説明できているコメントは良いコメント
   - 実装の説明ではなく、その実装によりどういうことが実現されているのかを書くようにする
     - // 配信可能なバナーを優先的に取り出す
     - // おすすめの商品順にソートする
 - 名前付き引数コメント
   - これはすごいテク（実務で使うかは微妙やけど）
   - Pythonとかやと`Connect(timeut_ms = 10, is_encripted = false);`と書ける
   - Javaとかやと`Connect(/* timeut_ms = */ 10, /* is_encripted = */ false);`みたいに書く

---

# ループとロジックの単純化

---

## 制御フローを読みやすくする

## 巨大な式を分割する

## 変数と読みやすさ

---

# コードの再構成

---

## 無関係の下位問題を抽出する

## 一度に一つのことを

## コードに思いを込める

## 短いコードを書く

---

# 選抜テーマ

---

## テストと読みやすさ

## 「分／時間カウンタ」を設計・実装する

